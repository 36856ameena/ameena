<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
  import { getFirestore, collection, getDocs, query, where } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCdbl9d34M_AIwE83k-2xEAnw_DLQhYm4U",
    authDomain: "vac-ass.firebaseapp.com",
    projectId: "vac-ass",
    storageBucket: "vac-ass.firebasestorage.app",
    messagingSenderId: "161511658313",
    appId: "1:161511658313:web:a3ffe1c54c72e97a84c098",
    measurementId: "G-QSG2BEQN6J"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  const dataContainer = document.getElementById("dataContainer");
  const searchCity = document.getElementById("searchCity");

  // Function to display data
  function displayData(list) {
    dataContainer.innerHTML = "";
    if (list.length === 0) {
      dataContainer.innerHTML = "<p>No data found.</p>";
      return;
    }

    list.forEach((item) => {
      const card = document.createElement("div");
      card.className = "card";
      card.innerHTML = `
        <h3>${item.name}</h3>
        <p>Role: ${item.role}</p>
        <p>Blood Group: ${item.bloodGroup}</p>
        <p>City: ${item.city}</p>
        <p>Contact: ${item.contact}</p>
      `;
      dataContainer.appendChild(card);
    });
  }

  // Fetch data from Firestore
  async function fetchData() {
    const donorsSnapshot = await getDocs(collection(db, "donors"));
    const receiversSnapshot = await getDocs(collection(db, "receivers"));

    const donors = donorsSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data(), role: "Donor" }));
    const receivers = receiversSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data(), role: "Receiver" }));

    return [...donors, ...receivers];
  }

  let allData = [];

  // Initial load
  fetchData().then(data => {
    allData = data;
    displayData(allData);
  });

  // Search by city
  searchCity.addEventListener("input", () => {
    const filtered = allData.filter(item =>
      item.city.toLowerCase().includes(searchCity.value.toLowerCase())
    );
    displayData(filtered);
  });
</script>
